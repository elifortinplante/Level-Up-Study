<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Level Up Study</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #74ebd5, #ACB6E5);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      color: #333;
      position: relative;
      overflow: hidden;
    }
    h1 { margin-bottom: 10px; text-align: center; }
    .avatar { font-size: 100px; margin: 20px 0; transition: transform 0.3s; }
    .xp-bar { width: 300px; height: 25px; background: #eee; border-radius: 12px; overflow: hidden; margin-bottom: 20px; }
    .xp-fill { height: 100%; width: 0%; background: #ffd700; transition: width 0.3s; }
    .timer { font-size: 40px; margin-bottom: 20px; }
    .buttons button { font-size: 18px; padding: 10px 20px; margin: 5px; border: none; border-radius: 10px; cursor: pointer; transition: transform 0.2s; }
    .buttons button:hover { transform: scale(1.1); }
    .message { font-size: 18px; margin-top: 20px; min-height: 24px; text-align: center; }
    .challenges { margin-top: 20px; text-align: left; width: 300px; }
    .challenge.completed { text-decoration: line-through; color: green; }
    .settings { margin-bottom: 20px; }
    .settings input { width: 50px; padding: 5px; margin: 0 5px; border-radius: 5px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>📚 Level Up Study</h1>
  <div class="avatar" id="avatar">🐣</div>
  <div>Niveau : <span id="level">1</span></div>
  <div class="xp-bar">
    <div class="xp-fill" id="xpFill"></div>
  </div>
  <div>XP : <span id="xp">0</span> / 100</div>

  <div class="settings">
    Durée étude (min): <input type="number" id="studyTime" value="25" min="1">  
    Durée pause (min): <input type="number" id="breakTime" value="5" min="1">
  </div>

  <div class="timer" id="timer">25:00</div>
  <div class="buttons">
    <button id="startBtn">Démarrer</button>
    <button id="pauseBtn">Pause</button>
    <button id="resetBtn">Réinitialiser</button>
  </div>

  <div class="message" id="message"></div>

  <div class="challenges">
    <h3>Défis :</h3>
    <ul>
      <li id="challenge1">Étudie 25 min</li>
      <li id="challenge2">Complète 2 sessions</li>
    </ul>
  </div>

  <script>
    let level = parseInt(localStorage.getItem('level')) || 1;
    let xp = parseInt(localStorage.getItem('xp')) || 0;
    const xpToLevel = 100;

    const avatar = document.getElementById('avatar');
    const xpFill = document.getElementById('xpFill');
    const xpText = document.getElementById('xp');
    const levelText = document.getElementById('level');
    const message = document.getElementById('message');
    const timerEl = document.getElementById('timer');

    const studyTimeInput = document.getElementById('studyTime');
    const breakTimeInput = document.getElementById('breakTime');

    let timer = parseInt(studyTimeInput.value) * 60;
    let timerInterval = null;
    let onBreak = false;

    // Tableau d’emojis pour niveaux 1–99
    const emojis = [
      '🐣','🐥','🐔','🦄','🐲','🐱‍👤','🐉','🤖','👑','🏆',
      '✨','🌟','💫','🌈','🔥','⚡','🌙','☀️','🌻','🌸',
      '🍀','🍎','🍇','🍉','🍌','🍓','🥑','🥦','🥕','🌽',
      '🏀','⚽','🏐','🎾','🎮','🎲','🎯','🎹','🎸','🥁',
      '🚗','🚀','🛸','🚁','🚤','🛶','🏰','🏯','🏟️','🗼',
      '🎁','🎈','🎉','🎊','🎃','🎄','🎂','🍰','🍩','🍪',
      '💎','🔮','🪐','🧸','🛍️','📚','📖','✏️','🖊️','🖌️',
      '🛹','🚴','🏊','🤹','🧗','🪁','🎣','🪀','🛷','🪃',
      '🦋','🐝','🐞','🕊️','🦅','🦉','🦄','🐙','🦑','🦐',
      '🧩','🧸','🪀','🪁','🪄','🎤','🎧','🎼','🎷','🎺',
      '🛡️','⚔️','🏹','🗡️','🪓','⛏️','🪃','🧱','🪜','🛎️'
    ];

    function updateUI() {
      xpText.textContent = xp;
      levelText.textContent = level;
      let percent = Math.min((xp / xpToLevel) * 100, 100);
      xpFill.style.width = percent + '%';

      if(level === 100) {
        avatar.innerHTML = '<img src="https://img.freepik.com/vecteurs-libre/composition-couronne-laurier-trophee-image-realiste-coupe-or-decoree-guirlandes-reflexion_1284-32301.jpg" alt="Trophée d\'or" style="width: 100px; height: auto;">';
      } else {
        avatar.textContent = emojis[Math.min(level-1, emojis.length-1)];
      }

      localStorage.setItem('xp', xp);
      localStorage.setItem('level', level);
    }

    function updateTimerDisplay() {
      let minutes = Math.floor(timer / 60);
      let seconds = timer % 60;
      timerEl.textContent = `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
    }

    function startTimer() {
      if(timerInterval) return;
      const sessionDuration = parseInt(studyTimeInput.value);
      const breakDuration = parseInt(breakTimeInput.value);

      timerInterval = setInterval(() => {
        timer--;
        updateTimerDisplay();
        if(timer <= 0) {
          clearInterval(timerInterval);
          timerInterval = null;
          if(!onBreak) {
            const earnedXP = sessionDuration * 2;
            gainXP(earnedXP);
            message.textContent = `Session terminée! 🎉 +${earnedXP} XP. Prends ta pause.`;
            onBreak = true;
            timer = breakDuration * 60;
            startTimer();
            checkChallenges();
          } else {
            message.textContent = "Pause terminée! Retour à l'étude 💪";
            onBreak = false;
            timer = sessionDuration * 60;
          }
        }
      }, 1000);
    }

    function pauseTimer() { clearInterval(timerInterval); timerInterval = null; }
    function resetTimer() { 
      clearInterval(timerInterval); 
      timerInterval = null; 
      timer = onBreak ? parseInt(breakTimeInput.value)*60 : parseInt(studyTimeInput.value)*60; 
      updateTimerDisplay(); 
    }

    function gainXP(amount) {
      xp += amount;

      // Pop-up XP
      const xpPopup = document.createElement('div');
      xpPopup.textContent = `+${amount} XP`;
      xpPopup.style.position = 'absolute';
      xpPopup.style.top = '50%';
      xpPopup.style.left = '50%';
      xpPopup.style.transform = 'translate(-50%, -50%)';
      xpPopup.style.fontSize = '24px';
      xpPopup.style.color = '#ffd700';
      xpPopup.style.fontWeight = 'bold';
      xpPopup.style.opacity = '1';
      xpPopup.style.transition = 'all 1s ease-out';
      document.body.appendChild(xpPopup);

      setTimeout(() => {
        xpPopup.style.top = '40%';
        xpPopup.style.opacity = '0';
      }, 50);

      setTimeout(() => { xpPopup.remove(); }, 1000);

      // Niveaux
      while(xp >= xpToLevel) {
        xp -= xpToLevel;
        if(level < 100) {
          level++;
          // Animation level-up
          avatar.style.transform = 'scale(1.5)';
          message.textContent = `🎉 Niveau supérieur ! Niveau ${level}`;
          setTimeout(() => { avatar.style.transform = 'scale(1)'; }, 500);
        }
      }
      updateUI();
    }

    function checkChallenges() {
      const challenge1 = document.getElementById('challenge1');
      const challenge2 = document.getElementById('challenge2');
      if(xp >= 50) challenge1.classList.add('completed');
      if(level >= 2) challenge2.classList.add('completed');
    }

    document.getElementById('startBtn').addEventListener('click', startTimer);
    document.getElementById('pauseBtn').addEventListener('click', pauseTimer);
    document.getElementById('resetBtn').addEventListener('click', resetTimer);

    studyTimeInput.addEventListener('change', () => {
      if(!onBreak) timer = parseInt(studyTimeInput.value) * 60;
      updateTimerDisplay();
    });
    breakTimeInput.addEventListener('change', () => {
      if(onBreak) timer = parseInt(breakTimeInput.value) * 60;
      updateTimerDisplay();
    });

    updateTimerDisplay();
    updateUI();
  </script>
</body>
</html>
