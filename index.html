<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Level Up Study</title>
<style>
body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #74ebd5, #ACB6E5); display:flex; flex-direction:column; align-items:center; min-height:100vh; margin:0; padding:20px; color:#333; position:relative;}
h1 { text-align:center; margin-bottom:10px; }
.avatar { font-size:100px; margin:20px 0; transition: transform 0.3s; }
#streak { font-size:24px; margin-bottom:10px; }
.xp-bar { width:300px; height:25px; background:#eee; border-radius:12px; overflow:hidden; margin-bottom:10px; }
.xp-fill { height:100%; width:0%; background:#ffd700; transition:width 0.3s; }
.timer { font-size:40px; margin-bottom:10px; }
.buttons button { font-size:18px; padding:10px 20px; margin:5px; border:none; border-radius:10px; cursor:pointer; transition: transform 0.2s; }
.buttons button:hover { transform: scale(1.1); }
.message { font-size:18px; margin-top:20px; min-height:24px; text-align:center; }
.settings { margin-bottom:20px; }
.settings input { padding:5px; margin:0 5px; border-radius:5px; border:1px solid #ccc; }
#resetAllBtn { position:absolute; top:10px; right:10px; padding:8px 12px; border-radius:8px; border:none; background:#ff4d4d; color:white; cursor:pointer; }
#objectives { margin-top:10px; font-size:16px; text-align:center; }
</style>
</head>
<body>

<h1>üìö Level Up Study</h1>
<button id="resetAllBtn">Tout r√©initialiser</button>

<div class="avatar" id="avatar">üê£</div>
<div id="streak">üî•üî•üî•</div>
<div>Niveau : <span id="level">1</span></div>
<div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
<div>XP : <span id="xp">0</span> / 100</div>

<div class="settings">
Dur√©e √©tude (min): <input type="number" id="studyTime" value="25" min="1">
Dur√©e pause (min): <input type="number" id="breakTime" value="5" min="1">
</div>

<div class="timer" id="timer">25:00</div>
<div class="buttons">
<button id="startBtn">D√©marrer</button>
<button id="pauseBtn">Pause</button>
<button id="resetBtn">R√©initialiser</button>
</div>

<div class="message" id="message"></div>
<div id="objectives">
<p>Objectif du jour : 25 min d‚Äô√©tude</p>
<p>Progression : 0 / 25 min</p>
</div>

<script>
let level = parseInt(localStorage.getItem('level')) || 1;
let xp = parseInt(localStorage.getItem('xp')) || 0;
const xpToLevel = 100;
const XP_PER_MINUTE = 2;

const avatar = document.getElementById('avatar');
const xpFill = document.getElementById('xpFill');
const xpText = document.getElementById('xp');
const levelText = document.getElementById('level');
const timerEl = document.getElementById('timer');
const studyTimeInput = document.getElementById('studyTime');
const breakTimeInput = document.getElementById('breakTime');
const objectivesEl = document.getElementById('objectives');

const emojis = ['üê£','üê•','üêî','ü¶Ñ','üê≤','üê±‚Äçüë§','üêâ','ü§ñ','üëë','üèÜ','‚ú®','üåü','üí´','üåà','üî•','‚ö°','üåô','‚òÄÔ∏è','üåª','üå∏','üçÄ','üçé','üçá','üçâ','üçå','üçì','ü•ë','ü•¶','ü•ï','üåΩ','üèÄ','‚öΩ','üèê','üéæ','üéÆ','üé≤','üéØ','üéπ','üé∏','ü•Å','üöó','üöÄ','üõ∏','üöÅ','üö§','üõ∂','üè∞','üèØ','üèüÔ∏è','üóº','üéÅ','üéà','üéâ','üéä','üéÉ','üéÑ','üéÇ','üç∞','üç©','üç™','üíé','üîÆ','ü™ê','üß∏','üõçÔ∏è','üìö','üìñ','‚úèÔ∏è','üñäÔ∏è','üñåÔ∏è','üõπ','üö¥','üèä','ü§π','üßó','ü™Å','üé£','ü™Ä','üõ∑','ü™É','ü¶ã','üêù','üêû','üïäÔ∏è','ü¶Ö','ü¶â','ü¶Ñ','üêô','ü¶ë','ü¶ê','üß©','üß∏','ü™Ä','ü™Å','ü™Ñ','üé§','üéß','üéº','üé∑','üé∫','üõ°Ô∏è','‚öîÔ∏è','üèπ','üó°Ô∏è','ü™ì','‚õèÔ∏è','ü™É','üß±','ü™ú','üõéÔ∏è'];

let streak = JSON.parse(localStorage.getItem('streak')) || { count: 0, lastDate: null };
let objectives = { dailyMinutes: 0 };

let timerInterval = null;
let timeLeft = parseInt(studyTimeInput.value)*60;
let onBreak = false;
let endTime = localStorage.getItem('endTime') ? parseInt(localStorage.getItem('endTime')) : null;

// ------------------- TIMER -------------------
function updateTimerDisplay() {
  let minutes = Math.floor(timeLeft / 60);
  let seconds = timeLeft % 60;
  timerEl.textContent = `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
}

function startTimer() {
  if(timerInterval) return;
  if(!endTime) endTime = Date.now() + timeLeft*1000;
  localStorage.setItem('endTime', endTime);

  timerInterval = setInterval(()=>{
    timeLeft = Math.round((endTime - Date.now())/1000);
    if(timeLeft <=0){
      clearInterval(timerInterval);
      timerInterval = null;

      // ajouter XP si session d'√©tude
      if(!onBreak){
        xp += Math.round(studyTimeInput.value*XP_PER_MINUTE);
        if(xp >= xpToLevel){
            xp -= xpToLevel;
            level++;
        }
      }

      updateUI();

      // vibration
      if(navigator.vibrate) navigator.vibrate([500,200,500,200,500]);

      // bascule √©tude/pause
      onBreak = !onBreak;
      timeLeft = onBreak ? parseInt(breakTimeInput.value)*60 : parseInt(studyTimeInput.value)*60;
      endTime = Date.now() + timeLeft*1000;
      localStorage.setItem('endTime', endTime);
      updateTimerDisplay();
      return;
    }
    updateTimerDisplay();
  },1000);
}

function pauseTimer() {
  clearInterval(timerInterval);
  timerInterval = null;
  endTime = Date.now()+timeLeft*1000;
  localStorage.setItem('endTime', endTime);
}

function resetTimer() {
  clearInterval(timerInterval);
  timerInterval = null;
  onBreak=false;
  timeLeft=parseInt(studyTimeInput.value)*60;
  endTime=null;
  localStorage.removeItem('endTime');
  updateTimerDisplay();
}

// ------------------- UI -------------------
function updateUI(){
  document.getElementById('xp').textContent = xp;
  document.getElementById('level').textContent = level;
  xpFill.style.width = Math.min((xp/xpToLevel)*100,100)+'%';
  avatar.innerHTML = (level===100) ? '<img src="https://img.freepik.com/vecteurs-libre/composition-couronne-laurier-trophee-image-realiste-coupe-or-decoree-guirlandes-reflexion_1284-32301.jpg" style="width:100px;">' : emojis[Math.min(level-1,emojis.length-1)];
  updateStreakUI();
  updateObjectivesUI();
  localStorage.setItem('xp', xp);
  localStorage.setItem('level', level);
}

function updateStreakUI(){
  document.getElementById('streak').textContent = 'üî•'.repeat(streak.count);
}

function updateObjectivesUI(){
  objectivesEl.innerHTML = `<p>Objectif du jour : ${studyTimeInput.value} min d‚Äô√©tude</p>
  <p>Progression : ${objectives.dailyMinutes} / ${studyTimeInput.value} min</p>`;
}

// ----------------- BOUTONS -----------------
document.getElementById('startBtn').addEventListener('click', startTimer);
document.getElementById('pauseBtn').addEventListener('click', pauseTimer);
document.getElementById('resetBtn').addEventListener('click', resetTimer);

// ----------------- RESET TOUT -----------------
document.getElementById('resetAllBtn').addEventListener('click', ()=>{
  let c=0;
  function confirmStep(){
    if(c>=3){
      xp=0; level=1; streak={count:0,lastDate:null}; objectives={dailyMinutes:0};
      resetTimer();
      updateUI();
      alert('Tout a √©t√© r√©initialis√© ‚úÖ');
      return;
    }
    if(confirm(`√ätes-vous s√ªr ? (${c+1}/3)`)){
      c++;
      confirmStep();
    }
  }
  confirmStep();
});

// ----------------- LOAD PAGE -----------------
window.addEventListener('load', ()=>{
  if(localStorage.getItem('endTime')){
    endTime=parseInt(localStorage.getItem('endTime'));
    timeLeft=Math.max(Math.round((endTime-Date.now())/1000),0);
    if(timeLeft>0) startTimer();
    else {
      onBreak=!onBreak;
      timeLeft=onBreak?parseInt(breakTimeInput.value)*60:parseInt(studyTimeInput.value)*60;
      endTime=null;
      updateTimerDisplay();
    }
  }
  updateUI();
});

updateTimerDisplay();
updateUI();
updateObjectivesUI();
</script>
</body>
</html>
