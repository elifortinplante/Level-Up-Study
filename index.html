<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Level Up Study</title>
  <style>
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #74ebd5, #ACB6E5); display:flex; flex-direction:column; align-items:center; min-height:100vh; margin:0; padding:20px; color:#333; position:relative;}
    h1 { text-align:center; margin-bottom:10px; }
    .avatar { font-size:100px; margin:20px 0; transition: transform 0.3s; }
    .xp-bar { width:300px; height:25px; background:#eee; border-radius:12px; overflow:hidden; margin-bottom:20px; }
    .xp-fill { height:100%; width:0%; background:#ffd700; transition:width 0.3s; }
    .timer { font-size:40px; margin-bottom:20px; }
    .buttons button { font-size:18px; padding:10px 20px; margin:5px; border:none; border-radius:10px; cursor:pointer; transition: transform 0.2s; }
    .buttons button:hover { transform: scale(1.1); }
    .message { font-size:18px; margin-top:20px; min-height:24px; text-align:center; }
    .settings { margin-bottom:20px; }
    .settings input, .settings select { padding:5px; margin:0 5px; border-radius:5px; border:1px solid #ccc; }
    #resetAllBtn { position:absolute; top:10px; right:10px; padding:8px 12px; border-radius:8px; border:none; background:#ff4d4d; color:white; cursor:pointer; }
    #stopAlarmBtn { display:none; margin-top:10px; background:#4CAF50; color:white; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; }
  </style>
</head>
<body>

<h1>ğŸ“š Level Up Study</h1>

<button id="resetAllBtn">Tout rÃ©initialiser</button>

<div class="avatar" id="avatar">ğŸ£</div>
<div>Niveau : <span id="level">1</span></div>
<div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
<div>XP : <span id="xp">0</span> / 100</div>

<div class="settings">
  DurÃ©e Ã©tude (min): <input type="number" id="studyTime" value="25" min="1">  
  DurÃ©e pause (min): <input type="number" id="breakTime" value="5" min="1">
  <label for="alarmSelect">Sonnerie :</label>
  <select id="alarmSelect">
    <option value="audio/you-are-my-sunshine.mp3" selected>You Are My Sunshine ğŸµ</option>
  </select>
</div>

<div class="timer" id="timer">25:00</div>
<div class="buttons">
  <button id="startBtn">DÃ©marrer</button>
  <button id="pauseBtn">Pause</button>
  <button id="resetBtn">RÃ©initialiser</button>
</div>

<button id="stopAlarmBtn">OK âœ…</button>
<div class="message" id="message"></div>

<audio id="alarm" preload="auto"></audio>

<script>
let level = parseInt(localStorage.getItem('level')) || 1;
let xp = parseInt(localStorage.getItem('xp')) || 0;
const xpToLevel = 100;

const avatar = document.getElementById('avatar');
const xpFill = document.getElementById('xpFill');
const xpText = document.getElementById('xp');
const levelText = document.getElementById('level');
const message = document.getElementById('message');
const timerEl = document.getElementById('timer');
const alarm = document.getElementById('alarm');
const alarmSelect = document.getElementById('alarmSelect');
const stopAlarmBtn = document.getElementById('stopAlarmBtn');
const studyTimeInput = document.getElementById('studyTime');
const breakTimeInput = document.getElementById('breakTime');

let onBreak = false;
let timer = parseInt(studyTimeInput.value) * 60;
let timerInterval = null;
let endTime = null;

const emojis = ['ğŸ£','ğŸ¥','ğŸ”','ğŸ¦„','ğŸ²','ğŸ±â€ğŸ‘¤','ğŸ‰','ğŸ¤–','ğŸ‘‘','ğŸ†','âœ¨','ğŸŒŸ','ğŸ’«','ğŸŒˆ','ğŸ”¥','âš¡','ğŸŒ™','â˜€ï¸','ğŸŒ»','ğŸŒ¸','ğŸ€','ğŸ','ğŸ‡','ğŸ‰','ğŸŒ','ğŸ“','ğŸ¥‘','ğŸ¥¦','ğŸ¥•','ğŸŒ½','ğŸ€','âš½','ğŸ','ğŸ¾','ğŸ®','ğŸ²','ğŸ¯','ğŸ¹','ğŸ¸','ğŸ¥','ğŸš—','ğŸš€','ğŸ›¸','ğŸš','ğŸš¤','ğŸ›¶','ğŸ°','ğŸ¯','ğŸŸï¸','ğŸ—¼','ğŸ','ğŸˆ','ğŸ‰','ğŸŠ','ğŸƒ','ğŸ„','ğŸ‚','ğŸ°','ğŸ©','ğŸª','ğŸ’','ğŸ”®','ğŸª','ğŸ§¸','ğŸ›ï¸','ğŸ“š','ğŸ“–','âœï¸','ğŸ–Šï¸','ğŸ–Œï¸','ğŸ›¹','ğŸš´','ğŸŠ','ğŸ¤¹','ğŸ§—','ğŸª','ğŸ£','ğŸª€','ğŸ›·','ğŸªƒ','ğŸ¦‹','ğŸ','ğŸ','ğŸ•Šï¸','ğŸ¦…','ğŸ¦‰','ğŸ¦„','ğŸ™','ğŸ¦‘','ğŸ¦','ğŸ§©','ğŸ§¸','ğŸª€','ğŸª','ğŸª„','ğŸ¤','ğŸ§','ğŸ¼','ğŸ·','ğŸº','ğŸ›¡ï¸','âš”ï¸','ğŸ¹','ğŸ—¡ï¸','ğŸª“','â›ï¸','ğŸªƒ','ğŸ§±','ğŸªœ','ğŸ›ï¸'];

function updateUI() {
  xpText.textContent = xp;
  levelText.textContent = level;
  let percent = Math.min((xp / xpToLevel) * 100, 100);
  xpFill.style.width = percent + '%';
  avatar.innerHTML = (level===100) ? '<img src="https://img.freepik.com/vecteurs-libre/composition-couronne-laurier-trophee-image-realiste-coupe-or-decoree-guirlandes-reflexion_1284-32301.jpg" style="width:100px;">' : emojis[Math.min(level-1, emojis.length-1)];
  localStorage.setItem('xp', xp);
  localStorage.setItem('level', level);
}

function updateTimerDisplay() {
  let minutes = Math.floor(timer/60);
  let seconds = timer % 60;
  timerEl.textContent = `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
}

alarmSelect.addEventListener('change', ()=> { alarm.src = alarmSelect.value; });

studyTimeInput.addEventListener('change', ()=>{ if(!onBreak) { timer = parseInt(studyTimeInput.value)*60; updateTimerDisplay(); } });
breakTimeInput.addEventListener('change', ()=>{ if(onBreak) { timer = parseInt(breakTimeInput.value)*60; updateTimerDisplay(); } });

function startTimer() {
  if(timerInterval) return;
  timer = onBreak ? parseInt(breakTimeInput.value)*60 : parseInt(studyTimeInput.value)*60;
  endTime = Date.now() + timer*1000;
  localStorage.setItem('endTime', endTime);
  localStorage.setItem('onBreak', onBreak);
  timerInterval = setInterval(()=>{
    timer = Math.round((endTime - Date.now())/1000);
    if(timer <= 0){
      clearInterval(timerInterval);
      timerInterval = null;
      stopAlarmBtn.style.display = 'block';
      alarm.play().catch(()=>{});
      if(navigator.vibrate) navigator.vibrate([500,200,500]);
    }
    updateTimerDisplay();
  },1000);
}

stopAlarmBtn.addEventListener('click', ()=>{
  stopAlarmBtn.style.display = 'none';
  alarm.pause();
  alarm.currentTime = 0;
  if(!onBreak){
    const earnedXP = parseInt(studyTimeInput.value)*2;
    gainXP(earnedXP);
    message.textContent = `Session terminÃ©e! ğŸ‰ +${earnedXP} XP. Pause commence!`;
    onBreak = true;
    timer = parseInt(breakTimeInput.value)*60;
  } else {
    message.textContent = "Pause terminÃ©e! Retour Ã  l'Ã©tude ğŸ’ª";
    onBreak = false;
    timer = parseInt(studyTimeInput.value)*60;
  }
  endTime = Date.now() + timer*1000;
  startTimer();
});

function pauseTimer(){ clearInterval(timerInterval); timerInterval=null; }
function resetTimer(){ clearInterval(timerInterval); timerInterval=null; timer = onBreak ? parseInt(breakTimeInput.value)*60 : parseInt(studyTimeInput.value)*60; updateTimerDisplay(); }

function gainXP(amount){
  xp += amount;
  const xpPopup = document.createElement('div');
  xpPopup.textContent = `+${amount} XP`;
  xpPopup.style.position = 'absolute';
  xpPopup.style.top='50%';
  xpPopup.style.left='50%';
  xpPopup.style.transform='translate(-50%,-50%)';
  xpPopup.style.fontSize='24px';
  xpPopup.style.color='gold';
  xpPopup.style.fontWeight='bold';
  xpPopup.style.transition='all 1s ease-out';
  document.body.appendChild(xpPopup);
  setTimeout(()=>{ xpPopup.style.top='30%'; xpPopup.style.opacity='0'; },50);
  setTimeout(()=>{ document.body.removeChild(xpPopup); },1050);
  while(xp>=xpToLevel){ xp -= xpToLevel; level++; avatar.style.transform='scale(1.5)'; setTimeout(()=>{ avatar.style.transform='scale(1)'; },300);}
  updateUI();
}

document.getElementById('startBtn').addEventListener('click', startTimer);
document.getElementById('pauseBtn').addEventListener('click', pauseTimer);
document.getElementById('resetBtn').addEventListener('click', resetTimer);

document.getElementById('resetAllBtn').addEventListener('click', ()=>{
  let confirmations=0;
  function ask(){ if(confirm("ÃŠtes-vous sÃ»r ?")){ confirmations++; if(confirmations<3) ask(); else{ localStorage.clear(); xp=0; level=1; onBreak=false; clearInterval(timerInterval); timerInterval=null; timer=parseInt(studyTimeInput.value)*60; endTime=null; updateTimerDisplay(); updateUI(); message.textContent="Tout a Ã©tÃ© rÃ©initialisÃ© âœ…"; } } }
  ask();
});

window.addEventListener('load', ()=>{
  let savedEndTime = localStorage.getItem('endTime');
  if(savedEndTime){
    endTime = parseInt(savedEndTime);
    onBreak = localStorage.getItem('onBreak')==='true';
    timer = Math.round((endTime - Date.now())/1000);
    if(timer<0) timer = onBreak ? parseInt(breakTimeInput.value)*60 : parseInt(studyTimeInput.value)*60;
    updateTimerDisplay();
    updateUI();
  }
});

updateUI();
updateTimerDisplay();
</script>
</body>
</html>
